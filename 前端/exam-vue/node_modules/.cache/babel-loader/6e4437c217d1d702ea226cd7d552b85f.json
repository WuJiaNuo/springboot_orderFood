{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\src\\views\\system\\sysRole\\assignAuth.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\src\\views\\system\\sysRole\\assignAuth.vue","mtime":1665211274602},{"path":"C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\babel.config.js","mtime":1637306514000},{"path":"C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\sys_manage\\code\\guigu-system-front\\system-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBhcGkgZnJvbSAnQC9hcGkvc3lzdGVtL21lbnUnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ3JvbGVBdXRoJywKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIC8vIOeUqOadpeagh+ivhuaYr+WQpuato+WcqOS/neWtmOivt+axguS4reeahOagh+ivhiwg6Ziy5q2i6YeN5aSN5o+Q5LqkCiAgICAgIHN5c01lbnVMaXN0OiBbXSwKICAgICAgLy8g5omA5pyJCiAgICAgIGRlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiAnbmFtZScKICAgICAgfQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmZldGNoRGF0YSgpOwogIH0sCiAgbWV0aG9kczogewogICAgLyoKICAgIOWIneWni+WMlgogICAgKi8KICAgIGZldGNoRGF0YTogZnVuY3Rpb24gZmV0Y2hEYXRhKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHJvbGVJZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkOwogICAgICBhcGkudG9Bc3NpZ24ocm9sZUlkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICB2YXIgc3lzTWVudUxpc3QgPSByZXN1bHQuZGF0YTsKICAgICAgICBfdGhpcy5zeXNNZW51TGlzdCA9IHN5c01lbnVMaXN0OwoKICAgICAgICB2YXIgY2hlY2tlZElkcyA9IF90aGlzLmdldENoZWNrZWRJZHMoc3lzTWVudUxpc3QpOwoKICAgICAgICBjb25zb2xlLmxvZygnZ2V0UGVybWlzc2lvbnMoKSBjaGVja2VkSWRzJywgY2hlY2tlZElkcyk7CgogICAgICAgIF90aGlzLiRyZWZzLnRyZWUuc2V0Q2hlY2tlZEtleXMoY2hlY2tlZElkcyk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKgogICAg5b6X5Yiw5omA5pyJ6YCJ5Lit55qEaWTliJfooagKICAgICovCiAgICBnZXRDaGVja2VkSWRzOiBmdW5jdGlvbiBnZXRDaGVja2VkSWRzKGF1dGhzKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGluaXRBcnIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFtdOwogICAgICByZXR1cm4gYXV0aHMucmVkdWNlKGZ1bmN0aW9uIChwcmUsIGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS5zZWxlY3QgJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHByZS5wdXNoKGl0ZW0uaWQpOwogICAgICAgIH0gZWxzZSBpZiAoaXRlbS5jaGlsZHJlbikgewogICAgICAgICAgX3RoaXMyLmdldENoZWNrZWRJZHMoaXRlbS5jaGlsZHJlbiwgaW5pdEFycik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcHJlOwogICAgICB9LCBpbml0QXJyKTsKICAgIH0sCgogICAgLyoKICAgIOS/neWtmOadg+mZkOWIl+ihqAogICAgKi8KICAgIHNhdmU6IGZ1bmN0aW9uIHNhdmUoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgLy/ojrflj5bliLDlvZPliY3lrZDoioLngrkKICAgICAgLy9jb25zdCBjaGVja2VkTm9kZXMgPSB0aGlzLiRyZWZzLnRyZWUuZ2V0Q2hlY2tlZE5vZGVzKCkKICAgICAgLy/ojrflj5bliLDlvZPliY3lrZDoioLngrnlj4rniLboioLngrkKICAgICAgdmFyIGFsbENoZWNrZWROb2RlcyA9IHRoaXMuJHJlZnMudHJlZS5nZXRDaGVja2VkTm9kZXMoZmFsc2UsIHRydWUpOwogICAgICB2YXIgaWRMaXN0ID0gYWxsQ2hlY2tlZE5vZGVzLm1hcChmdW5jdGlvbiAobm9kZSkgewogICAgICAgIHJldHVybiBub2RlLmlkOwogICAgICB9KTsKICAgICAgY29uc29sZS5sb2coaWRMaXN0KTsKICAgICAgdmFyIGFzc2dpbk1lbnVWbyA9IHsKICAgICAgICByb2xlSWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkLAogICAgICAgIG1lbnVJZExpc3Q6IGlkTGlzdAogICAgICB9OwogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICBhcGkuZG9Bc3NpZ24oYXNzZ2luTWVudVZvKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBfdGhpczMubG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBfdGhpczMuJG1lc3NhZ2Uuc3VjY2VzcyhyZXN1bHQuJG1lc3NhZ2UgfHwgJ+WIhumFjeadg+mZkOaIkOWKnycpOwoKICAgICAgICBfdGhpczMuJHJvdXRlci5wdXNoKCcvc3lzdGVtL3N5c1JvbGUnKTsKICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;EACAA,gBADA;EAGAC,IAHA,kBAGA;IACA;MACAC,cADA;MACA;MACAC,eAFA;MAEA;MACAC;QACAC,oBADA;QAEAC;MAFA;IAHA;EAQA,CAZA;EAcAC,OAdA,qBAcA;IACA;EACA,CAhBA;EAkBAC;IACA;AACA;AACA;IACAC,SAJA,uBAIA;MAAA;;MACA;MACAC;QACA;QACA;;QACA;;QACAC;;QACA;MACA,CANA;IAOA,CAbA;;IAeA;AACA;AACA;IACAC,aAlBA,yBAkBAC,KAlBA,EAkBA;MAAA;;MAAA;MACA;QACA;UACAC;QACA,CAFA,MAEA;UACA;QACA;;QACA;MACA,CAPA,EAOAC,OAPA;IAQA,CA3BA;;IA6BA;AACA;AACA;IACAC,IAhCA,kBAgCA;MAAA;;MACA;MACA;MACA;MACA;MACA;QAAA;MAAA;MACAL;MACA;QACAM,4BADA;QAEAC;MAFA;MAIA;MACAR;QACA;;QACA;;QACA;MACA,CAJA;IAKA;EAjDA;AAlBA","names":["name","data","loading","sysMenuList","defaultProps","children","label","created","methods","fetchData","api","console","getCheckedIds","auths","pre","initArr","save","roleId","menuIdList"],"sourceRoot":"src/views/system/sysRole","sources":["assignAuth.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <div style=\"padding: 20px 20px 0 20px;\">\r\n      授权角色：{{ $route.query.roleName }}\r\n    </div>\r\n    <el-tree\r\n      style=\"margin: 20px 0\"\r\n      ref=\"tree\"\r\n      :data=\"sysMenuList\"\r\n      node-key=\"id\"\r\n      show-checkbox\r\n      default-expand-all\r\n      :props=\"defaultProps\"\r\n    />\r\n    <div style=\"padding: 20px 20px;\">\r\n      <el-button :loading=\"loading\" type=\"primary\" icon=\"el-icon-check\" size=\"mini\" @click=\"save\">保存</el-button>\r\n      <el-button @click=\"$router.push('/system/sysRole')\" size=\"mini\" icon=\"el-icon-refresh-right\">返回</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import api from '@/api/system/menu'\r\n  export default {\r\n    name: 'roleAuth',\r\n\r\n    data() {\r\n      return {\r\n        loading: false, // 用来标识是否正在保存请求中的标识, 防止重复提交\r\n        sysMenuList: [], // 所有\r\n        defaultProps: {\r\n          children: 'children',\r\n          label: 'name'\r\n        },\r\n      };\r\n    },\r\n\r\n    created() {\r\n      this.fetchData()\r\n    },\r\n\r\n    methods: {\r\n      /*\r\n      初始化\r\n      */\r\n      fetchData() {\r\n        const roleId = this.$route.query.id\r\n        api.toAssign(roleId).then(result => {\r\n          const sysMenuList = result.data\r\n          this.sysMenuList = sysMenuList\r\n          const checkedIds = this.getCheckedIds(sysMenuList)\r\n          console.log('getPermissions() checkedIds', checkedIds)\r\n          this.$refs.tree.setCheckedKeys(checkedIds)\r\n        })\r\n      },\r\n\r\n      /*\r\n      得到所有选中的id列表\r\n      */\r\n      getCheckedIds (auths, initArr = []) {\r\n        return auths.reduce((pre, item) => {\r\n          if (item.select && item.children.length === 0) {\r\n            pre.push(item.id)\r\n          } else if (item.children) {\r\n            this.getCheckedIds(item.children, initArr)\r\n          }\r\n          return pre\r\n        }, initArr)\r\n      },\r\n\r\n      /*\r\n      保存权限列表\r\n      */\r\n      save() {\r\n        //获取到当前子节点\r\n        //const checkedNodes = this.$refs.tree.getCheckedNodes()\r\n        //获取到当前子节点及父节点\r\n        const allCheckedNodes = this.$refs.tree.getCheckedNodes(false, true);\r\n        let idList = allCheckedNodes.map(node => node.id);\r\n        console.log(idList)\r\n        let assginMenuVo = {\r\n          roleId: this.$route.query.id,\r\n          menuIdList: idList\r\n        }\r\n        this.loading = true\r\n        api.doAssign(assginMenuVo).then(result => {\r\n          this.loading = false\r\n          this.$message.success(result.$message || '分配权限成功')\r\n          this.$router.push('/system/sysRole');\r\n        })\r\n      }\r\n    }\r\n  };\r\n</script>"]}]}